# 3ï¸âƒ£ Capa de AplicaciÃ³n (puertos, commands, responses, services)

---

En esta capa es donde verÃ¡s la `arquitectura hexagonal en su mÃ¡xima expresiÃ³n`, porque aquÃ­ es donde los
puertos conectan todo sin que nada sepa nada de infraestructura.

### ğŸ‘‰ Rol de la capa de aplicaciÃ³n

- Coordina el flujo de los casos de uso.
- Orquesta entidades de dominio, repositorios y servicios externos.
- Define contratos claros (commands y responses) entre el mundo externo y el dominio.
- No contiene lÃ³gica de negocio detallada, esa vive en el dominio.
- Se asegura de que las reglas del negocio se ejecuten en el orden correcto.

### ğŸ‘‰ Orden natural de construcciÃ³n:

````
DTOs(commands y responses) â†’ Puertos de Entrada (Use Cases) â†’ Puerto de Salida â†’ Commands â†’ Responses â†’ Service
````

### ğŸ‘‰ Enfoque `Vertical Slicing`

Trabajaremos feature por feature, manteniendo consistencia:

````
customer â†’ account â†’ transaction
````

---

# ğŸ‘¤ Customer

## Customer â€“ DTOs

### ğŸ“˜ Conceptos clave

- `Commands` â†’ son objetos de entrada que encapsulan los datos necesarios para ejecutar un caso de uso.
    - Ejemplo: `CreateCustomerCommand` representa la intenciÃ³n de registrar un nuevo cliente.
    - Ejemplo: `UpdateCustomerCommand` representa la intenciÃ³n de actualizar datos de un cliente existente.

- `Responses` â†’ son objetos de salida que encapsulan los datos que el caso de uso devuelve al adaptador de entrada
  (ej. controlador REST).
    - Nunca se expone la entidad de dominio directamente, se traduce a un DTO de respuesta.
    - Ejemplo: `CustomerResponse` devuelve informaciÃ³n del cliente en un formato seguro y estable para la API.

### âœ… Buenas prÃ¡cticas reflejadas

- `SeparaciÃ³n clara` â†’ `Commands` y `Responses` son contratos entre `aplicaciÃ³n` e `infraestructura`.
- `Inmutabilidad` â†’ al usar `record`, los DTOs son inmutables y expresivos.
- `Lenguaje del negocio` â†’ los nombres comunican intenciÃ³n (`CreateCustomerCommand`, `CustomerResponse`).
- `ProtecciÃ³n del dominio` â†’ nunca se expone directamente la entidad de dominio `Customer`.

### Command

````java
public record CreateCustomerCommand(String documentNumber,
                                    DocumentType documentType,
                                    String firstName,
                                    String lastName,
                                    String email,
                                    String phone) {
}
````

````java
public record UpdateCustomerCommand(String firstName,
                                    String lastName,
                                    String phone) {
}
````

### Response

````java
public record CustomerResponse(String customerCode,
                               String documentNumber,
                               DocumentType documentType,
                               String firstName,
                               String lastName,
                               String fullName,
                               String email,
                               String phone,
                               CustomerStatus status,
                               LocalDateTime createdAt,
                               LocalDateTime updatedAt) {
}
````

## ğŸ“‘ Customer â€“ Puertos de Entrada (Use Cases)

Los `puertos de entrada` son `interfaces` que definen `QUÃ‰ puede hacer el sistema` desde el exterior. Cada caso de uso
es una interfaz separada (`Interface Segregation Principle`). El controlador REST los inyecta y los invoca sin saber
nada de la implementaciÃ³n concreta.

Cada caso de uso es una interfaz separada con un Ãºnico mÃ©todo `execute()`. Esto aplica el principio de segregaciÃ³n de
interfaces: el controlador solo inyecta los casos de uso que necesita, no un servicio gigante con todo.

````java
public interface CreateCustomerUseCase {
    CustomerResponse execute(CreateCustomerCommand command);
}
````

````java
public interface GetCustomerByIdUseCase {
    CustomerResponse execute(String customerCode);
}
````

````java
public interface GetAllCustomersUseCase {
    List<CustomerResponse> execute();
}
````

````java
public interface UpdateCustomerUseCase {
    CustomerResponse execute(String customerCode, UpdateCustomerCommand command);
}
````

````java
public interface DeleteCustomerUseCase {
    void execute(String customerCode);
}
````
