# üè¶ Sistema de Gesti√≥n de Cuentas Bancarias ‚Äî `banking-account-service`

---

# 1Ô∏è‚É£ Configuraci√≥n inicial del proyecto (application.yml + Flyway)

---

## Dependencias

En esta primera etapa iniciamos creando el proyecto `banking-account-service` a trav√©s de
[Spring Initializr (ver dependencias)](https://start.spring.io/#!type=maven-project&language=java&platformVersion=4.0.3&packaging=jar&configurationFileFormat=yaml&jvmVersion=25&groupId=dev.magadiflo.banking.app&artifactId=banking-account-service&name=banking-account-service&description=Demo%20project%20for%20Spring%20Boot&packageName=dev.magadiflo.banking.app&dependencies=web,data-jpa,validation,postgresql,flyway,lombok)
donde seleccionamos las dependencias necesarias para constuir un servicio bancario robusto.

La √∫nica dependencia agregada manualmente fue `MapStruct`, junto con su `plugin` para facilitar la generaci√≥n de mapeos
entre objetos.

````xml
<!--Spring Boot 4.0.3-->
<!--Java 25-->
<!--org.mapstruct.version 1.6.3-->
<!--lombok-mapstruct-binding.version 0.2.0-->
<dependencies>
    <!-- ===== SPRING BOOT ===== -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-jpa</artifactId>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-webmvc</artifactId>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-validation</artifactId>
    </dependency>

    <!-- ===== BASE DE DATOS ===== -->
    <dependency>
        <groupId>org.postgresql</groupId>
        <artifactId>postgresql</artifactId>
        <scope>runtime</scope>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-flyway</artifactId>
    </dependency>
    <dependency>
        <groupId>org.flywaydb</groupId>
        <artifactId>flyway-database-postgresql</artifactId>
    </dependency>

    <!-- ===== MAPSTRUCT ===== -->
    <dependency>
        <groupId>org.mapstruct</groupId>
        <artifactId>mapstruct</artifactId>
        <version>${org.mapstruct.version}</version>
    </dependency>

    <!-- ===== LOMBOK ===== -->
    <dependency>
        <groupId>org.projectlombok</groupId>
        <artifactId>lombok</artifactId>
        <optional>true</optional>
    </dependency>

    <!-- ===== TESTING ===== -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-jpa-test</artifactId>
        <scope>test</scope>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-flyway-test</artifactId>
        <scope>test</scope>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-validation-test</artifactId>
        <scope>test</scope>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-webmvc-test</artifactId>
        <scope>test</scope>
    </dependency>
</dependencies>
````

### üîé Explicaci√≥n de las dependencias

- `spring-boot-starter-data-jpa` ‚Üí Proporciona integraci√≥n con JPA/Hibernate, ideal para manejar entidades y
  repositorios.
- `spring-boot-starter-webmvc` ‚Üí Permite construir APIs REST usando el modelo MVC.
- `spring-boot-starter-validation` ‚Üí A√±ade soporte para validaciones con anotaciones como `@NotNull`, `@Size`, etc.
- `postgresql` ‚Üí Driver JDBC para conectarse a la base de datos PostgreSQL.
- `flyway` ‚Üí Herramienta de migraci√≥n de base de datos, asegura que el esquema evolucione de forma controlada.
- `mapstruct` ‚Üí Generador de mapeos entre DTOs y entidades, evitando c√≥digo repetitivo.
- `lombok` ‚Üí Reduce el boilerplate con anotaciones como `@Getter`, `@Builder`, etc.
- `testing starters` ‚Üí Facilitan pruebas unitarias e integraci√≥n para cada m√≥dulo (JPA, Flyway, Web, Validation).

### ‚öôÔ∏è Configuraci√≥n de Plugins

Los plugins en el `pom.xml` permiten que el proyecto compile correctamente y procese anotaciones.

- `maven-compiler-plugin` ‚Üí Define la versi√≥n de Java y gestiona los annotation processors.
    - Aqu√≠ se incluyen `Lombok` y `MapStruct`, que generan c√≥digo autom√°ticamente durante la compilaci√≥n.
- `spring-boot-maven-plugin` ‚Üí Empaqueta la aplicaci√≥n como un `fat JAR` ejecutable y permite correrla con
  `mvn spring-boot:run`.
    - La exclusi√≥n de Lombok evita conflictos en tiempo de ejecuci√≥n, ya que Lombok solo es necesario en compilaci√≥n.

````xml

<build>
    <plugins>
        <!--MapStruct-->
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-compiler-plugin</artifactId>
            <version>${maven-compiler-plugin.version}</version>
            <configuration>
                <source>${java.version}</source>
                <target>${java.version}</target>
                <annotationProcessorPaths>
                    <path>
                        <groupId>org.projectlombok</groupId>
                        <artifactId>lombok</artifactId>
                        <version>${lombok.version}</version>
                    </path>
                    <path>
                        <groupId>org.mapstruct</groupId>
                        <artifactId>mapstruct-processor</artifactId>
                        <version>${org.mapstruct.version}</version>
                    </path>
                    <path>
                        <groupId>org.projectlombok</groupId>
                        <artifactId>lombok-mapstruct-binding</artifactId>
                        <version>${lombok-mapstruct-binding.version}</version>
                    </path>
                </annotationProcessorPaths>
            </configuration>
        </plugin>
        <!--/MapStruct-->
        <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
            <configuration>
                <excludes>
                    <exclude>
                        <groupId>org.projectlombok</groupId>
                        <artifactId>lombok</artifactId>
                    </exclude>
                </excludes>
            </configuration>
        </plugin>
    </plugins>
</build>
````

## ‚öôÔ∏è Configuraciones en el application.yml

En esta secci√≥n definimos las propiedades de configuraci√≥n del servicio `banking-account-service`, centralizando
par√°metros de servidor, base de datos, migraciones y servicios externos.

````yml
server:
  port: 8080
  error:
    include-message: always

spring:
  application:
    name: banking-account-service

  datasource:
    url: jdbc:postgresql://localhost:5435/db_hexagonal
    username: magadiflo
    password: magadiflo

  jpa:
    hibernate:
      ddl-auto: validate    # validate: hibernate solo valida el schema, Flyway es quien lo crea
    properties:
      hibernate:
        format_sql: true

  flyway:
    baseline-on-migrate: true
    validate-on-migrate: true
    enabled: true
    locations: classpath:db/migration
    baseline-description: 'init'
    baseline-version: 0

# ===== Configuraci√≥n personalizada del servicio externo (ExchangeRate API) =====
exchange-rate:
  api:
    base-url: https://v6.exchangerate-api.com/v6
    api-key: YOUR_API_KEY_HERE     # Reemplazar con el API key real
    timeout-seconds: 5

logging:
  level:
    dev.magadiflo: debug
    org.hibernate.SQL: debug
    org.flywaydb: info
````

- `hibernate.ddl-auto: validate` ‚Üí Hibernate solo valida que el esquema de la BD coincida con las entidades.
    - No crea ni modifica tablas.
    - La responsabilidad de migraciones recae en `Flyway` (buena pr√°ctica en entornos productivos).

- `spring.flyway`
    - `baseline-on-migrate: true` ‚Üí Permite inicializar la base de datos con una versi√≥n base cuando ya existen tablas.
    - `validate-on-migrate: true` ‚Üí Verifica que las migraciones aplicadas coincidan con el historial esperado.
    - `enabled: true` ‚Üí Activa `Flyway` en la aplicaci√≥n.
    - `locations: classpath:db/migration` ‚Üí Carpeta donde se ubican los scripts SQL de migraci√≥n.
    - `baseline-description: 'init'` ‚Üí Descripci√≥n de la versi√≥n inicial.
    - `baseline-version: 0` ‚Üí Define la versi√≥n base de la migraci√≥n.

